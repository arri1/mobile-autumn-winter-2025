# Запуск нескольких симуляторов для тестирования видеозвонков

## Варианты запуска

### Вариант 1: iOS симуляторы (Mac)

1. **Откройте первый симулятор:**
   ```bash
   npm start
   # Нажмите 'i' для iOS симулятора
   # Или выберите конкретный симулятор из списка
   ```

2. **Откройте второй симулятор:**
   - Откройте Xcode → Window → Devices and Simulators
   - Или используйте команду:
     ```bash
     open -a Simulator
     ```
   - В новом симуляторе откройте Safari и перейдите по URL из Expo DevTools
   - Или используйте Expo Go и отсканируйте QR-код

### Вариант 2: Android эмуляторы

1. **Запустите первый эмулятор:**
   ```bash
   npm start
   # Нажмите 'a' для Android эмулятора
   ```

2. **Запустите второй эмулятор:**
   ```bash
   # В Android Studio создайте/запустите второй AVD (Android Virtual Device)
   # Затем подключитесь через Expo Go или откройте URL в браузере эмулятора
   ```

### Вариант 3: Комбинация iOS + Android

1. Запустите `npm start`
2. Нажмите `i` для iOS симулятора
3. Нажмите `a` для Android эмулятора
4. Оба будут подключены к одному серверу разработки

### Вариант 4: Симулятор + Физическое устройство

1. Запустите `npm start --tunnel` (использует ngrok для туннеля)
2. Подключите физическое устройство по той же Wi-Fi сети
3. Отсканируйте QR-код в Expo Go на устройстве
4. Запустите симулятор нажав `i` или `a`

### Вариант 5: Два физических устройства

1. Запустите `npm start --tunnel`
2. Отсканируйте QR-код на обоих устройствах
3. Оба устройства будут использовать один и тот же код

## Полезные команды

### Посмотреть список доступных iOS симуляторов:
```bash
xcrun simctl list devices available
```

### Запустить конкретный iOS симулятор:
```bash
xcrun simctl boot "iPhone 15"
# или
xcrun simctl boot "iPhone 15 Pro"
```

### Запустить приложение на конкретном симуляторе:
```bash
# После запуска expo start, откройте второй терминал:
npx expo start --ios --device "iPhone 15 Pro"
```

### Просмотр всех запущенных симуляторов:
```bash
xcrun simctl list devices | grep Booted
```

## Важные замечания для видеозвонков

1. **IP адрес бэкенда:**
   - Для симуляторов на одной машине используйте `localhost:3000`
   - Для физических устройств используйте IP вашего компьютера в локальной сети
   - Пример: `http://192.168.1.100:3000` (замените на ваш IP)

2. **Обновление API URL:**
   - В `src/services/api.js` убедитесь, что `baseURL` доступен с обоих устройств
   - Для физических устройств используйте IP вашего компьютера, а не localhost

3. **WebRTC требует:**
   - Оба устройства должны быть доступны друг другу через сеть
   - STUN/TURN серверы должны быть правильно настроены
   - Для локальной разработки может потребоваться туннель (ngrok) или VPN

## Рекомендуемый workflow для тестирования

1. **Запустите бэкенд:**
   ```bash
   cd test-backend
   npm start
   ```

2. **Запустите Expo Dev Server:**
   ```bash
   cd mobile-app
   npm start
   ```

3. **Откройте первый симулятор:**
   - Нажмите `i` для iOS или `a` для Android

4. **Откройте второй симулятор/устройство:**
   - Используйте Expo Go или браузер для подключения
   - Или запустите второй экземпляр симулятора

5. **Войдите с разными пользователями:**
   - На первом устройстве: `admin@example.com` / `admin123`
   - На втором устройстве: `user@example.com` / `user123`

6. **Начните звонок:**
   - На первом устройстве найдите второго пользователя в списке
   - Нажмите кнопку звонка
   - Тестируйте WebRTC соединение

## Troubleshooting

### Проблема: Второй симулятор не подключается
**Решение:** Убедитесь, что используете тот же QR-код/URL, или запустите `expo start --tunnel`

### Проблема: API недоступен с устройства
**Решение:** 
- Измените `baseURL` в `api.js` на IP вашего компьютера
- Проверьте, что бэкенд доступен по сети (не только localhost)
- Используйте `npm start --tunnel` для туннеля

### Проблема: WebRTC не работает между устройствами
**Решение:**
- Убедитесь, что оба устройства в одной сети
- Проверьте настройки файрвола
- Используйте публичные STUN/TURN серверы (уже настроены)
- Для локальной разработки может потребоваться ngrok туннель

